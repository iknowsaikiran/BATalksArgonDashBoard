<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="../assets/img/favicon.png">
    <title>
        In House page For BA talks Pvt Ltd
    </title>
    {% include 'header.html'%}

    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>


    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
    <!-- Nucleo Icons -->
    <link href="https://demos.creative-tim.com/argon-dashboard-pro/assets/css/nucleo-icons.css" rel="stylesheet" />
    <link href="https://demos.creative-tim.com/argon-dashboard-pro/assets/css/nucleo-svg.css" rel="stylesheet" />
    <!-- Font Awesome Icons -->
    <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
    <!-- CSS Files -->
    <link id="pagestyle" href="../assets/css/argon-dashboard.css?v=2.1.0" rel="stylesheet" />
    <style>
        body {
            overflow-x: hidden;
        }
        .btn{
            background-color: #512888;
            color:white
          }
    </style>
    
</head>

<body class="g-sidenav-show   bg-gray-100">
    <div class="min-height-300 bg-dark position-absolute w-100"></div>

    <main class="main-content position-relative border-radius-lg ">
        <div class="container-fluid py-4">
            <div class="row ">
                <div class="col-12">
                    <div class="card mb-4">
                        <div class="card-header pb-0 d-flex">
                            
                                <h3 class="fontsz">Leave Request</h3>
                            
                        </div>
                        <div class="card-body px-0 pt-0 pb-2">
                            <form method="POST" class="needs-validation p-2" novalidate>
                                <!-- Leave Type Section -->
                                <div class="mb-3 row">
                                    <div class="col-md-4">
                                        <label for="leave_type" class="col-12 col-md-4 col-form-label">Leave
                                            Type</label>
                                        <div>
                                            <select class="form-select col-12 col-md-4" name="leave_type"
                                                id="leave_type" required>
                                                <option value="" style="padding-right: 0; width: auto;">Select Leave
                                                    Type</option>
                                                <option value="sick" style="padding-right: 0; width: auto;">Sick Leave
                                                </option>
                                                <option value="casual" style="padding-right: 0; width: auto;">Casual
                                                    Leave</option>
                                            </select>
                                        </div>

                                    </div>
                                    <!-- Start Date Section -->
                                    <div class="col-md-4">
                                        <label for="start_date" class="col-12 col-md-4 col-form-label">Start
                                            Date</label>
                                        <input type="text" class="form-control" name="start_date" id="start_date"
                                            placeholder="Select Start Date" readonly required>
                                    </div>
                                    <!-- End Date Section -->
                                    <div class="col-md-4">
                                        <label for="end_date" class="col-12 col-md-4 col-form-label">End Date</label>

                                        <input type="text" class="form-control" name="end_date" id="end_date"
                                            placeholder="Select End Date" readonly required>
                                    </div>
                                    <div class=" col-md-6">
                                        <label for="reason" class="col-12 col-md-4 col-form-label">Reason</label>
                                        <div class="col-12 col-md-8">
                                            <textarea class="form-control" name="reason" rows="5" id="reason"
                                                placeholder="Reason" required></textarea>
                                        </div>
                                    </div>
                                    <!-- Request Button -->
                                    <div class="text-center">
                                        <button type="submit" class="btn  btn-lg">Request</button>
                                    </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <div class="card mb-4">
                    <div class="card-header pb-0">
                        <h6>Leave List</h6>
                    </div>
                    <div class="card-body px-0 pt-0 pb-2">
                        <div class="table-responsive p-0">
                            <table class="table align-items-center justify-content-center mb-0 ">
                                <thead>
                                    <tr>
                                        <th class="text-uppercase text-secondary text-large font-weight-bolder opacity-7">
                                        </th>
                                        <th
                                            class="text-uppercase text-secondary text-large font-weight-bolder opacity-7 ps-2">
                                            SL.NO</th>
                                        <th
                                            class="text-uppercase text-secondary text-large font-weight-bolder opacity-7 ps-2">
                                            lEAVE TYPE</th>
                                        <th
                                            class="text-uppercase text-secondary text-large font-weight-bolder opacity-7 ps-2">
                                            START DATE</th>
                                        <th
                                            class="text-uppercase text-secondary text-large font-weight-bolder opacity-7 ps-2">
                                            END DATE</th>
                                        <th
                                            class="text-uppercase text-secondary text-large font-weight-bolder opacity-7 ps-2">
                                            REASON DATE</th>
                                        <th
                                            class="text-uppercase text-secondary text-large font-weight-bolder opacity-7 ps-2">
                                            STATUS</th>
                                        <th class="text-uppercase text-secondary text-large font-weight-bolder opacity-7">
                                            DAYS</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for leave in leaves %}
                                    <tr>
                                        <td></td>
                                        <td class="justify-content-center ">{{ loop.index }}</td>
                                        <td class="justify-content-center ">{{ leave[2] }}
                                        </td>
                                        <td class="justify-content-center " style="word-break: break-all;">
                                            {{ leave[3] }}
                                        </td>
                                        <td class="justify-content-center ">
                                            {{ leave[4] }} </td>
                                        <td class="justify-content-center ">
                                            {{ leave[5] }}<br />
                                            {% if leave[7] is not none %}
                                            <span style="font-weight:normal;">Reason: {{ leave[7] }}</span>
                                            {% endif %}
                                        </td>
                                        <td class="justify-content-center" style="font-weight:bold;"
                                            data-status="{{ leave[6] }}">
                                            {{ leave[6] }}
                                        </td>
                                        <td id="daysDifference"></td> <!-- Difference will be displayed here -->
                                    </tr>
                                    <tr></tr>
                                    <tr></tr>
                                    {% endfor %}

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!--   Core JS Files   -->
    <script src="static/assets/js/core/popper.min.js"></script>
    <script src="static/assets/js/core/bootstrap.min.js"></script>
    <script src="static/assets/js/plugins/perfect-scrollbar.min.js"></script>
    <script src="static/assets/js/plugins/smooth-scrollbar.min.js"></script>

    <script>
        $(document).ready(function () {
            var today = new Date();
            var twoDaysAfter = new Date();
            twoDaysAfter.setDate(today.getDate() + 3);
    
            $('#start_date').datepicker({
                format: 'dd/mm/yyyy',
                autoclose: true,
                todayHighlight: true,
                startDate: twoDaysAfter // Set minimum start date
            }).on('changeDate', function (e) {
                $('#end_date').removeAttr("readonly");
                $('#end_date').datepicker('setStartDate', e.date);
            });

            $('#end_date').datepicker({
                format: 'dd/mm/yyyy',
                autoclose: true,
                todayHighlight: true
            }).on('changeDate', function (e) {
                checkFields(); // Validate form
            });
    
            $('#leave_type').change(function () {
                var leaveType = $(this).val();
                if (leaveType === "casual") {
                    $('#start_date').datepicker('setStartDate', twoDaysAfter);
                    $('#start_date').val('');
                    $('#end_date').val('');
                    $('#end_date').attr("readonly", true);
                } else {
                    $('#start_date').datepicker('setStartDate', today);
                    $('#start_date').val('');
                    $('#end_date').val('');
                    $('#end_date').attr("readonly", true);
                }
            });
        });
    </script>


    <!-- <script>
        $(document).ready(function () {
            // Function to format the date to dd/mm/yyyy
            var formatDateToDDMMYYYY = function (date) {
                var dd = String(date.getDate()).padStart(2, '0');
                var mm = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-based
                var yyyy = date.getFullYear();
                return dd + '/' + mm + '/' + yyyy;
            };

            // Initialize today's date and two days after today
            var today = new Date();
            var formattedToday = formatDateToDDMMYYYY(today);
            var twoDaysAfter = new Date(today);
            twoDaysAfter.setDate(today.getDate() + 3); // Set to 2 days after today
            var formattedTwoDaysAfter = formatDateToDDMMYYYY(twoDaysAfter);

            // Initialize datepicker for start and end dates with dd/mm/yyyy format
            $('#start_date').datepicker({
                format: 'dd/mm/yyyy',
                autoclose: true,
                todayHighlight: true,
            }).on('changeDate', function (e) {
                // Enable end_date and set minimum date to the selected start date
                $('#end_date').removeAttr("readonly");
                $('#end_date').datepicker('setStartDate', e.date);
                checkFields(); // Validate form
            });

            $('#end_date').datepicker({
                format: 'dd/mm/yyyy',
                autoclose: true,
                todayHighlight: true
            }).on('changeDate', function (e) {
                checkFields(); // Validate form
            });

            // Function to check if all fields are filled and enable the submit button
            function checkFields() {
                const leaveType = $('#leave_type').val();
                const startDate = $('#start_date').val();
                const endDate = $('#end_date').val();
                const reason = $('#reason').val();

                // Enable the button if all fields are filled
                if (leaveType && startDate && endDate && reason) {
                    $('#submitBtn').prop('disabled', false);
                } else {
                    $('#submitBtn').prop('disabled', true);
                }
            }

            // Event listener for leave type change
            $('#leave_type').change(function () {
                var leaveType = $(this).val();
                var startDateInput = $('#start_date');
                var endDateInput = $('#end_date');

                if (leaveType === "casual") {
                    // Set minimum start date to 2 days after today
                    startDateInput.datepicker('setStartDate', twoDaysAfter);
                    startDateInput.val(''); // Clear any pre-selected value
                    endDateInput.val('');   // Clear end date value
                    endDateInput.attr("readonly", true); // Initially disable end date
                } else {
                    // Set minimum start and end dates to today for other leave types
                    startDateInput.datepicker('setStartDate', today);
                    startDateInput.val(''); // Clear any pre-selected value
                    endDateInput.val('');   // Clear end date value
                    endDateInput.attr("readonly", true); // Initially disable end date
                }

                checkFields(); // Validate form fields on leave type change
            });

            // Initial call to check if fields are pre-filled (e.g., after page load)
            checkFields();
        });
    </script> -->

    <script>
        function calculateDaysDifference(startDate, endDate) {
            // Create Date objects
            const start = new Date(startDate);
            const end = new Date(endDate);

            // Calculate the difference in milliseconds
            const differenceInMilliseconds = end - start;

            // Convert milliseconds to days
            const millisecondsInADay = 1000 * 60 * 60 * 24; // 1000 ms/sec * 60 sec/min * 60 min/hr * 24 hr/day
            const differenceInDays = Math.round(differenceInMilliseconds / millisecondsInADay);

            return differenceInDays;
        }

        function showDaysDifference() {
            // Get all rows in the tbody
            const rows = document.querySelectorAll('tbody tr');

            // Iterate through each row
            rows.forEach(row => {
                const startDateCell = row.querySelector('td:nth-child(4)'); // Start Date column
                const endDateCell = row.querySelector('td:nth-child(5)');   // End Date column
                const daysDifferenceCell = row.querySelector('td:nth-child(8)'); // Days Difference column

                if (startDateCell && endDateCell && daysDifferenceCell) {
                    const start = startDateCell.innerText.trim(); // Retrieve and trim the start date
                    const end = endDateCell.innerText.trim();     // Retrieve and trim the end date

                    const daysDifference = calculateDaysDifference(start, end);

                    // Display the result in the days difference cell
                    daysDifferenceCell.innerText = daysDifference + 1 + " days";
                }
            });
        }

        // Call the function when the page loads
        window.onload = showDaysDifference;
    </script>
    <script>
        var win = navigator.platform.indexOf('Win') > -1;
        if (win && document.querySelector('#sidenav-scrollbar')) {
            var options = {
                damping: '0.5'
            }
            Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
        }
    </script>
    <!-- Github buttons -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
    <script src="static/assets/js/argon-dashboard.min.js?v=2.0.4"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Get all cells with leave status
            const statusCells = document.querySelectorAll('td[data-status]');

            // Loop through each cell to set the color based on status
            statusCells.forEach(function (cell) {
                const status = cell.getAttribute('data-status');
                if (status === 'Approved') {
                    cell.style.color = 'green'; // Set color for approved status
                } else if (status === 'Rejected') {
                    cell.style.color = 'red'; // Set color for rejected status
                } else {
                    cell.style.color = 'grey'; // Default color for other statuses
                }
            });
        });
    </script>

</body>

</html>